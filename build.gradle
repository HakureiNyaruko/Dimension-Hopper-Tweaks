//file:noinspection GroovyAssignabilityCheck
plugins {
    id 'net.minecraftforge.gradle' version '6.0.+'
    id 'wtf.gofancy.fancygradle' version '1.1.+'
    id 'org.spongepowered.mixin' version '0.7.+'
}

fancyGradle {
    patches {
        resources
        coremods
        codeChickenLib
        asm
        mergetool
    }
}

group = mod_package
version = "${mod_version}+${minecraft_version}"

java.toolchain.getLanguageVersion().set(JavaLanguageVersion.of(8))

minecraft {
    mappings channel: 'stable', version: mappings_version
    accessTransformer = file("src/main/resources/META-INF/${mod_accesstransformer}")
    runs {
        def args = [
                '-Dmixin.debug.export=true',
                '-Dmixin.hotSwap=true',
                '-Dmixin.checks.interfaces=true'
        ]
        client {
            workingDirectory file('run')
            property 'forge.logging.markers', 'SCAN,REGISTRIES,REGISTRYDUMP'
            property 'forge.logging.console.level', 'trace'
            jvmArgs args
        }
        server {
            property 'forge.logging.markers', 'SCAN,REGISTRIES,REGISTRYDUMP'
            property 'forge.logging.console.level', 'trace'
            jvmArgs args
        }
    }
}

repositories {
    maven {
        name = 'CurseForge'
        url = uri('https://www.cursemaven.com')
        content {
            includeGroup 'curse.maven'
        }
    }
    maven {
        name = 'BlameJared'
        url = uri('https://maven.blamejared.com')
    }
    maven {
        name = 'SpongePowered'
        url = uri('https://repo.spongepowered.org/maven')
    }
    maven {
        name = 'Modrinth'
        url = uri('https://api.modrinth.com/maven')
        content {
            includeGroup 'maven.modrinth'
        }
    }
}

dependencies {
    minecraft("net.minecraftforge:forge:${minecraft_version}-${forge_version}")

    //annotation processors
    annotationProcessor("com.google.code.gson:gson:${project.gson_annotation}")
    annotationProcessor("com.google.guava:guava:${project.guava_annotation}")
    annotationProcessor("org.ow2.asm:asm-debug-all:${project.asm_debug_annotation}")
    annotationProcessor("org.spongepowered:mixin:${mixin_version}") {
        transitive = false
    }

    //non cf dependencies
    compileOnly(fg.deobf("maven.modrinth:travelersbackpack:${backpack_version}"))
    compileOnly("CraftTweaker2:CraftTweaker2-MC1120-Mod-JEI:1.12-${project.ct_version}") {
        exclude group: 'com.google.code.gson'
        exclude group: 'deobf.mezz.jei'
        exclude group: 'org.ow2.asm'
    }
    compileOnly("org.spongepowered:mixin:${mixin_version}") {
        transitive = false
    }

    //cf dependencies
    compileOnly(fg.deobf("curse.maven:actually-additions-228404:${aa_version}"))
    compileOnly(fg.deobf("curse.maven:ae2-extended-life-570458:${ae2_verion}"))
    compileOnly(fg.deobf("curse.maven:aether-ii-917199:${aether_version}"))
    compileOnly(fg.deobf("curse.maven:aoa-311054:${aoa_version}"))
    compileOnly(fg.deobf("curse.maven:apotheosis-313970:${apotheosis_version}"))
    compileOnly(fg.deobf("curse.maven:aquaculture-60028:${aquaculture_version}"))
    compileOnly(fg.deobf("curse.maven:atum-59621:${atum_version}"))
    compileOnly(fg.deobf("curse.maven:avaritia-261348:${avaritia_version}"))
    compileOnly(fg.deobf("curse.maven:baubles-227083:${baubles_version}"))
    compileOnly(fg.deobf("curse.maven:bedrockcraft-363794:${bedrockcraft_version}"))
    compileOnly(fg.deobf("curse.maven:better-questing-629629:${bq_version}"))
    compileOnly(fg.deobf("curse.maven:betweenalnds-243363:${betweenlands_version}"))
    compileOnly(fg.deobf("curse.maven:biomes-o-plenty-220318:${bop_verison}"))
    compileOnly(fg.deobf("curse.maven:blue-skies-312918:${blueskies_version}"))
    compileOnly(fg.deobf("curse.maven:bookshelf-228525:${bookshelf_version}"))
    compileOnly(fg.deobf("curse.maven:botania-225643:${botania_version}"))
    compileOnly(fg.deobf("curse.maven:cavern-285628:${cavern_version}"))
    compileOnly(fg.deobf("curse.maven:ccl-242818:${ccl_version}"))
    compileOnly(fg.deobf("curse.maven:compact-machines-224218:${cm3_version}"))
    compileOnly(fg.deobf("curse.maven:cofh-core-69162:${cofhcore_version}"))
    compileOnly(fg.deobf("curse.maven:constructs-armory-287683:${conarm_version}"))
    compileOnly(fg.deobf("curse.maven:ctm-267602:${ctm_version}"))
    compileOnly(fg.deobf("curse.maven:dimensionaldoors-284876:${dimdoors_version}"))
    compileOnly(fg.deobf("curse.maven:draconic-evolution-223565:${de_version}"))
    compileOnly(fg.deobf("curse.maven:dropt-284973:${dropt_version}"))
    compileOnly(fg.deobf("curse.maven:ender-io-64578:${eio_version}"))
    compileOnly(fg.deobf("curse.maven:environmental-tech-245453:${et_version}"))
    compileOnly(fg.deobf("curse.maven:extended-crafting-398267:${excrafting_version}"))
    compileOnly(fg.deobf("curse.maven:extraplanets-241291:${extraplanets_version}"))
    compileOnly(fg.deobf("curse.maven:xu2-225561:${xu2_version}"))
    compileOnly(fg.deobf("curse.maven:fermiumbooter-968474:${fbooter_version}"))
    compileOnly(fg.deobf("curse.maven:forestry-59751:${forestry_version}"))
    compileOnly(fg.deobf("curse.maven:gaia-302529:${gaia_version}"))
    compileOnly(fg.deobf("curse.maven:galacticraft-564236:${galacticraft_version}"))
    compileOnly(fg.deobf("curse.maven:game-stages-268655:${gamestages_version}"))
    compileOnly(fg.deobf("curse.maven:geckolib-388172:${gecko_version}"))
    compileOnly(fg.deobf("curse.maven:glacidus-286530:${glacidus_version}"))
    compileOnly(fg.deobf("curse.maven:good-nights-sleep-61461:${gn_version}"))
    compileOnly(fg.deobf("curse.maven:hunting-dimension-283235:${huntingdim_version}"))
    compileOnly(fg.deobf("curse.maven:immersive-engineering-231951:${ie_version}"))
    compileOnly(fg.deobf("curse.maven:industrial-craft-242638:${ic2_version}"))
    compileOnly(fg.deobf("curse.maven:industrial-foregoing-266515:${if_version}"))
    compileOnly(fg.deobf("curse.maven:infernal-mobs-227875:${aim_version}"))
    compileOnly(fg.deobf("curse.maven:item-stages-280316:${itemstages_version}"))
    compileOnly(fg.deobf("curse.maven:jaopca-266936:${jaopca_version}"))
    compileOnly(fg.deobf("curse.maven:jec-242223:${jec_version}"))
    compileOnly(fg.deobf("curse.maven:jei-557549:${hei_version}"))
    compileOnly(fg.deobf("curse.maven:jer-240630:${jer_version}"))
    compileOnly(fg.deobf("curse.maven:libraryex-298965:${libex_version}"))
    compileOnly(fg.deobf("curse.maven:libnine-322344:${libnine_version}"))
    compileOnly(fg.deobf("curse.maven:lightningcraft-237422:${lightningcraft_version}"))
    compileOnly(fg.deobf("curse.maven:lockyz-283789:${lockyz_version}"))
    compileOnly(fg.deobf("curse.maven:loottweaker-255257:${lt_version}"))
    compileOnly(fg.deobf("curse.maven:mantle-74924:${mantle_version}"))
    compileOnly(fg.deobf("curse.maven:mcjtylib-233105:${mcjl_version}"))
    compileOnly(fg.deobf("curse.maven:mekanism-399904:${mce_version}"))
    compileOnly(fg.deobf("curse.maven:mekanism-tools-813407:${mcetools_version}"))
    compileOnly(fg.deobf("curse.maven:mo-bends-231347:${mobends_version}"))
    compileOnly(fg.deobf("curse.maven:moretweaker-336569:${moretweaker_version}"))
    compileOnly(fg.deobf("curse.maven:more-planets-261990:${moreplanets_version}"))
    compileOnly(fg.deobf("curse.maven:multiblocked-604054:${mbd_version}"))
    compileOnly(fg.deobf("curse.maven:natures-aura-306626:${na_version}"))
    compileOnly(fg.deobf("curse.maven:neat-238372:${neat_version}"))
    compileOnly(fg.deobf("curse.maven:netherex-248039:${netherex_version}"))
    compileOnly(fg.deobf("curse.maven:nodamitem-377815:${nodami_verion}"))
    compileOnly(fg.deobf("curse.maven:nyx-349214:${nyx_version}"))
    compileOnly(fg.deobf("curse.maven:openblocks-228816:${openblocks_version}"))
    compileOnly(fg.deobf("curse.maven:openmodslib-228815:${openlib_version}"))
    compileOnly(fg.deobf("curse.maven:overloaded-264601:${overloaded_version}"))
    compileOnly(fg.deobf("curse.maven:packagedauto-308380:${packagedauto_version}"))
    compileOnly(fg.deobf("curse.maven:packagedexcrafting-322861:${packagedex_version}"))
    compileOnly(fg.deobf("curse.maven:plustic-376903:${plustic_version}"))
    compileOnly(fg.deobf("curse.maven:projecte-226410:${projecte_version}"))
    compileOnly(fg.deobf("curse.maven:projectex-311378:${projectex_version}"))
    compileOnly(fg.deobf("curse.maven:psi-241665:${psi_version}"))
    compileOnly(fg.deobf("curse.maven:psio-339394:${psio_version}"))
    compileOnly(fg.deobf("curse.maven:quality-tools-264756:${qt_version}"))
    compileOnly(fg.deobf("curse.maven:quark-243121:${quark_version}"))
    compileOnly(fg.deobf("curse.maven:random-things-59816:${randomthings_version}"))
    compileOnly(fg.deobf("curse.maven:recipe-stages-280554:${recipestages_version}"))
    compileOnly(fg.deobf("curse.maven:redstone-flux-270789:${rf_version}"))
    compileOnly(fg.deobf("curse.maven:reliquary-241319:${xreliquary_version}"))
    compileOnly(fg.deobf("curse.maven:reskillable-286382:${reskillable_version}"))
    compileOnly(fg.deobf("curse.maven:scaling-health-248027:${scalinghealth_version}"))
    compileOnly(fg.deobf("curse.maven:sgcraft-289115:${sgcraft_version}"))
    compileOnly(fg.deobf("curse.maven:silent-gems-220311:${sgems_version}"))
    compileOnly(fg.deobf("curse.maven:silent-lib-242998:${slib_version}"))
    compileOnly(fg.deobf("curse.maven:stevekungs-lib-296019:${sglib_version}"))
    compileOnly(fg.deobf("curse.maven:tesla-244651:${tesla_version}"))
    compileOnly(fg.deobf("curse.maven:tesla-core-254602:${tclib_version}"))
    compileOnly(fg.deobf("curse.maven:the-impossible-library-661115:${til_version}"))
    compileOnly(fg.deobf("curse.maven:thermal-cultivation-271835:${thermalcultivation_version}"))
    compileOnly(fg.deobf("curse.maven:thermal-expansion-69163:${thermalexpansion_version}"))
    compileOnly(fg.deobf("curse.maven:tinker-i-o-229503:${tio_version}"))
    compileOnly(fg.deobf("curse.maven:tinkers-construct-74072:${tconstruct_version}"))
    compileOnly(fg.deobf("curse.maven:tiny-progressions-250850:${tp_version}"))
    compileOnly(fg.deobf("curse.maven:together-forever-285968:${together_version}"))
    compileOnly(fg.deobf("curse.maven:tombstone-243707:${ctombstone_version}"))
    compileOnly(fg.deobf("curse.maven:tool-progression-266550:${toolprog_version}"))
    compileOnly(fg.deobf("curse.maven:translocators-247695:${translocators_version}"))
    compileOnly(fg.deobf("curse.maven:triumph-235492:${triumph_version}"))
    compileOnly(fg.deobf("curse.maven:twilight-forest-227639:${tf_version}"))
    compileOnly(fg.deobf("curse.maven:unidict-244258:${unidict_version}"))
    compileOnly(fg.deobf("curse.maven:valkyrielib-245480:${valklib_version}"))
    compileOnly(fg.deobf("curse.maven:vintagefix-871198:${vf_version}"))
    compileOnly(fg.deobf("curse.maven:wanionlib-253043:${wlib_version}"))
    compileOnly(fg.deobf("curse.maven:xl-food-247217:${xlfood_version}"))
    compileOnly(fg.deobf("curse.maven:zollern-galaxy-241940:${zollern_version}"))
}

processResources {
    duplicatesStrategy = DuplicatesStrategy.INCLUDE
    inputs.properties('modid': mod_id, 'name': mod_name, 'description': mod_description, 'version': version,
            'mcversion': minecraft_version, 'url': mod_url, 'credits': mod_credits, 'logo': mod_logo)
    from(sourceSets.main.resources.srcDirs) {
        include 'mcmod.info'
        expand 'modid': mod_id, 'name': mod_name, 'description': mod_description, 'version': version,
                'mcversion': minecraft_version, 'url': mod_url, 'credits': mod_credits, 'logo': mod_logo
    }
    from(sourceSets.main.resources.srcDirs) {
        exclude 'mcmod.info'
    }
}

mixin {
    add sourceSets.main, mod_refmap
}

jar {
    archiveBaseName = mod_id
    manifest {
        attributes([
                'DHT_DEPENDENCIES': mod_dependencies,
                'DHT_NAME' : mod_name,
                'DHT_VERSION' : mod_version,
                'FMLAT': mod_accesstransformer,
                'FMLCorePlugin': "${mod_package}.${mod_plugin}",
                'FMLCorePluginContainsFMLMod': true,
                'ForceLoadAsMod': true,
                'TweakClass': mod_tweakclass
        ])
    }
}